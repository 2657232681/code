{% extends "base.html" %}


{% block body %}







    <div class="vertical-align-wrap">
        <div class="vertical-align-middle">
            <div class="auth-box ">
                <div class="left">
                    <div class="content">
                        <div class="header">
                            <p class="lead">账号注册</p>
                        </div>
                        <form class="form-auth-small" action="javascript:void(0)">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="signin-email" class="control-label sr-only">账号</label>
                                <input type="text" class="form-control p_input" placeholder="请输入用户名"
                                       name="username">
                            </div>
                            <div class="form-group">
                                <label for="signin-password" class="control-label sr-only">密码</label>
                                <input type="password" class="form-control" id="password" name="password"
                                       placeholder="请输入密码">
                            </div>
                            <div class="form-group">
                                <label for="signin-password" class="control-label sr-only">确认密码</label>
                                <input type="password" class="form-control" id="password2" name="password2"
                                       placeholder="请再次输入密码">
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg btn-block">注册</button>
                            <div class="bottom">
                                <span class="helper-text"><i class="fa fa-lock"></i> 已有账号?<a href="/login">登录</a></span>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="right">
                    <div class="overlay"></div>
                    <div class="content text">
                        <h1 class="heading">{{ project_name }}</h1>

                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>















{% endblock %}


{% block script %}
    <script>
        (function ($) {
            'use strict';
            $.fn.andSelf = function () {
                return this.addBack.apply(this, arguments);
            }
            $(function () {
                $.fn.andSelf = function () {
                    return this.addBack.apply(this, arguments);
                }
                $("button[type='submit']").click(function (e) {
                    var username = $("input[name='username']").val();
                    var password = $("input[name='password']").val();
                    var password2 = $("input[name='password2']").val();
                    var csrfmiddlewaretoken = $("input[name='csrfmiddlewaretoken']").val();

                    if (username == "" || password == "" || password2 == "") {
                        // e.preventDefault();
                        toastr["warning"]("用户名或密码不能为空", '', {positionClass: "toast-top-right"});

                        return;
                    }
                    if (password != password2) {
                        toastr["warning"]("两次密码不一致", '', {positionClass: "toast-top-right"});

                        return;
                    }

                    $.ajax({
                        url: "/register/",
                        type: "post",
                        dataType: "json",
                        data: {
                            username: username,
                            password: password,
                            password2: password2,
                            csrfmiddlewaretoken: csrfmiddlewaretoken
                        },
                        success: function (data) {
                            if (data.code == 200) {
                                window.location.href = "/";
                            } else {
                                toastr["warning"](data.msg, '', {positionClass: "toast-top-right"});

                            }
                        }
                    })
                })


            })
        })(jQuery);
    </script>
{% endblock %}



