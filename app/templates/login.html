{% extends "base.html" %}


{% block body %}




    <div class="vertical-align-wrap">
			<div class="vertical-align-middle">
				<div class="auth-box ">
					<div class="left">
						<div class="content">
							<div class="header">
								<p class="lead">账号登录</p>
							</div>
							<form class="form-auth-small" action="javascript:void(0)">
                                 {% csrf_token %}
								<div class="form-group">
									<label for="signin-email" class="control-label sr-only">账号</label>
       <input type="text" class="form-control p_input" placeholder="请输入用户名"
                                           name="username">
                                </div>
								<div class="form-group">
									<label for="signin-password" class="control-label sr-only">密码</label>
									<input type="password" class="form-control" id="password" name="password" placeholder="请输入密码">
								</div>

								<button type="submit" class="btn btn-primary btn-lg btn-block">登录</button>
								<div class="bottom">
									<span class="helper-text"><i class="fa fa-lock"></i> 还没账号?<a href="/register">注册</a></span>
								</div>
							</form>
						</div>
					</div>
					<div class="right">
						<div class="overlay"></div>
						<div class="content text">
							<h1 class="heading">{{ project_name }}</h1>

						</div>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
		</div>




{% endblock %}


{% block script %}
    <script>
        (function ($) {
            'use strict';
            $.fn.andSelf = function () {
                return this.addBack.apply(this, arguments);
            }
            $(function () {
                $.fn.andSelf = function () {
                    return this.addBack.apply(this, arguments);
                }
                $("button[type='submit']").click(function (e) {
                    var username = $("input[name='username']").val();
                    var password = $("input[name='password']").val();
                    var csrfmiddlewaretoken = $("input[name='csrfmiddlewaretoken']").val();
                    if (username == "" || password == "") {
                        // e.preventDefault();
                        toastr["warning"]("用户名或密码不能为空", '', {positionClass: "toast-top-right"});

                        return;
                    }

                    $.ajax({
                        url: "/login/",
                        type: "post",
                        dataType: "json",
                        data: {
                            username: username,
                            csrfmiddlewaretoken: csrfmiddlewaretoken,
                            password: password
                        },
                        success: function (data) {
                            if (data.code == 200) {
                                window.location.href = "/";
                            } else {
                                toastr["warning"](data.msg, '', {positionClass: "toast-top-right"});

                            }
                        }
                    })
                })


            })
        })(jQuery);
    </script>
{% endblock %}



